# HyperGraphRAG 可视化快速开始指南

欢迎使用 HyperGraphRAG 可视化系统！本指南将帮助您快速上手，在几分钟内开始探索您的超图知识库。

## 目录

- [系统要求](#系统要求)
- [快速启动](#快速启动)
- [界面概览](#界面概览)
- [基础功能](#基础功能)
- [查询功能](#查询功能)
- [高级功能](#高级功能)
- [常见问题](#常见问题)

---

## 系统要求

### 必需软件

- **Python**: 3.10 或更高版本
- **Node.js**: 18.0 或更高版本
- **pnpm**: 8.0 或更高版本

### 浏览器支持

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

---

## 快速启动

### 方法一：使用 Docker（推荐）

最简单的启动方式，无需配置环境：

```bash
# 1. 启动所有服务
docker-compose up -d

# 2. 访问应用
# 前端: http://localhost:3400
# 后端 API: http://localhost:3401
# API 文档: http://localhost:3401/docs
```

### 方法二：本地开发

适合开发和调试：

#### 启动后端 API

```bash
# 1. 安装 Python 依赖
pip install -r requirements.txt

# 2. 配置环境变量（复制并编辑 .env 文件）
cp .env.example .env
# 编辑 .env 文件，设置 OpenAI API Key 等

# 3. 启动 API 服务器
python3 -m uvicorn api.main:app --host 0.0.0.0 --port 3401 --reload
```

#### 启动前端应用

```bash
# 1. 进入前端目录
cd web_ui

# 2. 安装依赖（使用 pnpm）
pnpm install

# 3. 启动开发服务器
pnpm dev

# 4. 访问应用
# 浏览器打开: http://localhost:3400
```

### 验证安装

1. **检查后端**：访问 http://localhost:3401/api/health
   - 应该看到：`{"status": "ok", ...}`

2. **检查前端**：访问 http://localhost:3400
   - 应该看到可视化界面

3. **检查 API 文档**：访问 http://localhost:3401/docs
   - 应该看到 Swagger UI 文档

---

## 界面概览

### 主界面布局

```
┌─────────────────────────────────────────────────────────┐
│  [Logo] HyperGraphRAG Visualization        [⚙️] [📤]    │
├──────────────┬──────────────────────────────────────────┤
│              │                                          │
│  侧边栏       │           图画布区域                      │
│              │                                          │
│  - 搜索框    │     [超图可视化显示区域]                  │
│  - 过滤器    │                                          │
│  - 查询面板  │     • 节点（实体）                        │
│  - 节点详情  │     • 边（关系）                          │
│              │     • 超边（多元关系）                    │
│              │                                          │
│              │                                          │
├──────────────┴──────────────────────────────────────────┤
│  状态栏: 节点数 | 边数 | 超边数                          │
└─────────────────────────────────────────────────────────┘
```

### 主要组件

1. **图画布**（中央区域）
   - 显示超图的可视化
   - 支持缩放、平移、拖拽

2. **侧边栏**（左侧）
   - 搜索栏：搜索实体
   - 过滤面板：按类型和权重过滤
   - 查询面板：执行 RAG 查询
   - 详情面板：显示选中节点/边的信息

3. **工具栏**（顶部）
   - 设置按钮：调整可视化参数
   - 导出按钮：导出图像或数据

4. **状态栏**（底部）
   - 显示图统计信息

---

## 基础功能

### 1. 浏览超图

#### 缩放和平移

- **缩放**：
  - 鼠标滚轮：向上滚动放大，向下滚动缩小
  - 触摸板：双指捏合缩放
  - 缩放范围：0.1x - 10x

- **平移**：
  - 鼠标拖拽：按住鼠标左键拖动画布
  - 触摸屏：单指拖动

- **重置视图**：
  - 点击工具栏的"重置视图"按钮
  - 或按键盘快捷键：`Ctrl/Cmd + 0`

#### 查看节点信息

1. **点击节点**：
   - 节点会高亮显示
   - 侧边栏显示详细信息：
     - 实体名称
     - 实体类型
     - 描述
     - 权重

2. **悬停节点**：
   - 显示快速提示（Tooltip）
   - 包含节点名称和类型

#### 查看边信息

1. **点击边**：
   - 边会高亮显示
   - 侧边栏显示：
     - 关系描述
     - 连接的实体
     - 是否为超边（3+ 实体）
     - 权重

2. **识别超边**：
   - 超边用特殊样式显示（虚线或不同颜色）
   - 在详情面板中标记为"超边"

### 2. 搜索实体

#### 使用搜索框

1. 在侧边栏顶部找到搜索框
2. 输入关键词（例如："hypertension"）
3. 系统会实时显示匹配结果
4. 点击搜索结果：
   - 视图自动聚焦到该节点
   - 节点高亮显示

#### 搜索技巧

- **语义搜索**：系统使用向量相似度，可以找到语义相关的实体
  - 搜索 "high blood pressure" 也能找到 "hypertension"
  
- **部分匹配**：输入部分关键词即可
  - 搜索 "hyper" 可以找到 "hypertension"

- **相关性排序**：结果按相关性得分排序

### 3. 过滤显示

#### 按实体类型过滤

1. 打开侧边栏的"过滤"面板
2. 选择要显示的实体类型：
   - ☑️ DISEASE（疾病）
   - ☑️ PERSON（人物）
   - ☑️ ORGANIZATION（组织）
   - ☑️ LOCATION（地点）
   - 等等...
3. 取消勾选的类型会被隐藏

#### 按权重过滤

1. 在过滤面板中找到"权重阈值"滑块
2. 拖动滑块设置最小权重（0.0 - 1.0）
3. 只显示权重大于阈值的边

#### 清除过滤

点击"重置过滤"按钮恢复显示所有内容。

### 4. 展开节点

#### 双击展开

1. 双击任意节点
2. 系统会加载该节点的邻居节点
3. 新节点以动画方式添加到图中

#### 控制展开深度

在设置面板中可以配置：
- 展开深度：1-3 跳
- 默认：1 跳（直接邻居）

---

## 查询功能

### 执行 RAG 查询

HyperGraphRAG 支持基于超图的检索增强生成（RAG）查询。

#### 基本查询流程

1. **打开查询面板**：
   - 点击侧边栏的"查询"标签

2. **输入查询**：
   - 在文本框中输入问题
   - 例如："What are the risk factors for cardiovascular disease?"

3. **选择查询模式**：
   - **Hybrid（混合）**：推荐，结合实体和关系信息
   - **Local（本地）**：基于实体描述
   - **Global（全局）**：基于关系描述
   - **Naive（朴素）**：简单 RAG，不使用图结构

4. **执行查询**：
   - 点击"查询"按钮
   - 等待结果（通常 2-5 秒）

5. **查看结果**：
   - 答案显示在结果面板
   - 查询路径在图中高亮显示

### 查询模式说明

#### Hybrid 模式（推荐）

结合实体和关系信息，提供最全面的答案。

**适用场景**：
- 复杂问题
- 需要多方面信息
- 不确定使用哪种模式

**示例**：
```
问题：What are the causes and treatments of diabetes?
答案：结合疾病实体信息和治疗关系信息
```

#### Local 模式

专注于实体描述，适合实体属性查询。

**适用场景**：
- 询问实体的定义、特征
- "What is X?"
- "Describe X"

**示例**：
```
问题：What is hypertension?
答案：基于 hypertension 实体的描述
```

#### Global 模式

专注于关系描述，适合关系查询。

**适用场景**：
- 询问实体间的关系
- "How are X and Y related?"
- "What connects X and Y?"

**示例**：
```
问题：How is diabetes related to cardiovascular disease?
答案：基于两者之间的关系描述
```

#### Naive 模式

简单的 RAG，不使用图结构。

**适用场景**：
- 对比测试
- 简单问题

### 查询路径可视化

#### 理解查询路径

执行查询后，图中会高亮显示：
- **访问的节点**：查询过程中检索的实体
- **访问的边**：使用的关系
- **相关性得分**：节点大小或颜色深度表示相关性

#### 路径动画

1. 点击"播放动画"按钮
2. 系统按检索顺序逐步高亮节点
3. 可以暂停、重播动画

#### 查看上下文

在结果面板中：
- **答案**：生成的回答
- **使用的上下文**：检索到的文本片段
- **执行时间**：查询耗时

### 查询历史

#### 查看历史

1. 点击"历史"标签
2. 显示最近的查询列表
3. 包含：
   - 查询文本
   - 查询模式
   - 执行时间
   - 时间戳

#### 重新执行

点击历史记录中的查询，可以重新执行。

#### 清除历史

点击"清除历史"按钮删除所有记录。

---

## 高级功能

### 导出功能

#### 导出图像

1. 点击工具栏的"导出"按钮
2. 选择格式：
   - **PNG**：位图格式，适合文档
   - **SVG**：矢量格式，适合编辑

3. 设置选项：
   - 分辨率（PNG）
   - 背景颜色
   - 是否包含标签

4. 点击"下载"

#### 导出数据

1. 选择"JSON"格式
2. 导出内容包括：
   - 所有节点数据
   - 所有边数据
   - 布局位置信息

3. 可用于：
   - 数据分析
   - 导入其他工具
   - 备份

### 自定义可视化

#### 打开设置面板

点击工具栏的"设置"按钮（⚙️）。

#### 布局参数

调整力导向布局：
- **引力强度**：节点间吸引力
- **斥力强度**：节点间排斥力
- **边长度**：理想边长
- **阻尼系数**：动画平滑度

**提示**：
- 增加斥力 → 节点更分散
- 增加引力 → 节点更紧凑
- 调整后点击"应用"查看效果

#### 颜色方案

选择预设的颜色主题：
- **默认**：多彩配色
- **蓝色**：蓝色系
- **灰度**：黑白配色
- **高对比度**：适合演示

或自定义每种实体类型的颜色。

#### 节点样式

- **节点大小**：调整节点半径（5-50px）
- **标签字体大小**：调整文字大小（8-24px）
- **显示标签**：开关节点标签显示

#### 边样式

- **边宽度**：调整边的粗细（1-10px）
- **超边样式**：虚线或实线
- **显示箭头**：开关方向箭头

#### 保存配置

配置会自动保存到浏览器本地存储，下次访问时自动恢复。

#### 重置配置

点击"重置为默认"恢复初始设置。

### 响应式设计

#### 桌面端

- 侧边栏固定在左侧
- 宽屏显示更多内容

#### 平板端

- 侧边栏可折叠
- 点击汉堡菜单（☰）切换显示

#### 移动端

- 全屏画布
- 底部抽屉显示控制面板
- 支持触摸手势：
  - 双指缩放
  - 单指拖动
  - 长按显示菜单

---

## 常见问题

### 安装和启动

**Q: 启动后端时报错 "ModuleNotFoundError"**

A: 确保已安装所有依赖：
```bash
pip install -r requirements.txt
```

**Q: 前端启动失败，提示 "command not found: pnpm"**

A: 安装 pnpm：
```bash
npm install -g pnpm
```

**Q: 浏览器显示 "Failed to fetch"**

A: 检查：
1. 后端是否正常运行（访问 http://localhost:3401/api/health）
2. 端口是否被占用
3. 防火墙是否阻止连接

### 使用问题

**Q: 图加载很慢或卡顿**

A: 尝试：
1. 使用过滤器减少显示的节点数
2. 在设置中启用"视口裁剪"
3. 降低节点数量限制

**Q: 搜索没有结果**

A: 可能原因：
1. 关键词拼写错误
2. 实体不存在于知识库
3. 尝试使用更通用的关键词

**Q: 查询返回错误**

A: 检查：
1. 是否配置了 OpenAI API Key（在 .env 文件中）
2. API Key 是否有效
3. 网络连接是否正常
4. 查看浏览器控制台的错误信息

**Q: 节点标签重叠，看不清**

A: 解决方法：
1. 放大视图（滚轮缩放）
2. 在设置中增加"斥力强度"
3. 调整"节点大小"和"标签字体大小"

**Q: 导出的图片不完整**

A: 确保：
1. 导出前将视图调整到合适位置
2. 选择足够高的分辨率
3. 使用 SVG 格式可以避免分辨率问题

### 性能优化

**Q: 如何提高大规模图的性能？**

A: 建议：
1. 使用过滤器只显示关键节点
2. 启用"懒加载"（设置中）
3. 减少初始加载的节点数（默认 1000）
4. 使用"视口裁剪"只渲染可见区域

**Q: 查询速度慢**

A: 可能原因：
1. 知识库很大
2. 网络延迟
3. LLM API 响应慢

优化方法：
- 减少 `top_k` 参数
- 使用更快的 LLM 模型
- 启用查询缓存

### 数据问题

**Q: 如何使用自己的数据？**

A: 步骤：
1. 准备文本数据
2. 使用 HyperGraphRAG 构建知识库：
   ```bash
   python script_construct.py
   ```
3. 数据会保存在 `expr/example/` 目录
4. 重启可视化系统即可加载新数据

**Q: 支持哪些数据格式？**

A: HyperGraphRAG 支持：
- 纯文本（.txt）
- Markdown（.md）
- JSON（.json）
- 其他文本格式

**Q: 如何更新知识库？**

A: 
1. 添加新文档到数据目录
2. 重新运行构建脚本
3. 重启可视化系统

### 其他问题

**Q: 支持多语言吗？**

A: 
- 界面：目前主要是中文和英文
- 数据：支持任何语言的文本（取决于 LLM）

**Q: 可以离线使用吗？**

A: 
- 可视化界面：可以离线使用
- 查询功能：需要网络连接（调用 LLM API）

**Q: 如何贡献代码？**

A: 
1. Fork 项目仓库
2. 创建功能分支
3. 提交 Pull Request
4. 参考 `docs/visualization/ARCHITECTURE.md` 了解架构

---

## 下一步

- 📖 阅读 [功能使用教程](./TUTORIAL.md) 了解更多高级用法
- 🏗️ 查看 [架构文档](./ARCHITECTURE.md) 了解系统设计
- 🔧 参考 [API 文档](../api/README.md) 进行二次开发
- 💬 加入社区讨论和反馈

---

## 获取帮助

遇到问题？
- 📝 查看 [常见问题](#常见问题)
- 🐛 提交 Issue 到 GitHub
- 📧 联系开发团队
- 💬 加入用户社区

祝您使用愉快！🎉
