# HyperGraphRAG 可视化功能使用教程

本教程将通过实际案例，详细介绍 HyperGraphRAG 可视化系统的各项功能。

## 目录

- [教程 1：探索医疗知识图谱](#教程-1探索医疗知识图谱)
- [教程 2：执行复杂查询](#教程-2执行复杂查询)
- [教程 3：分析查询路径](#教程-3分析查询路径)
- [教程 4：自定义可视化](#教程-4自定义可视化)
- [教程 5：导出和分享](#教程-5导出和分享)
- [最佳实践](#最佳实践)

---

## 教程 1：探索医疗知识图谱

**目标**：学习如何浏览和探索超图结构

**场景**：您有一个医疗领域的知识图谱，想要了解疾病之间的关系。

### 步骤 1：加载知识图谱

1. 启动应用后，系统会自动加载知识图谱
2. 观察状态栏显示的统计信息：
   ```
   节点: 1523 | 边: 4892 | 超边: 342
   ```

### 步骤 2：识别关键实体

1. 使用搜索功能找到感兴趣的疾病：
   - 在搜索框输入 "cardiovascular disease"
   - 点击搜索结果中的 "Cardiovascular Disease"

2. 观察节点详情：
   ```
   名称: Cardiovascular Disease
   类型: DISEASE
   描述: A class of diseases involving the heart or blood vessels
   权重: 0.95
   ```

### 步骤 3：探索相关实体

1. 双击 "Cardiovascular Disease" 节点
2. 系统会展开显示相关实体：
   - Hypertension（高血压）
   - Diabetes（糖尿病）
   - Cholesterol（胆固醇）
   - Smoking（吸烟）

3. 观察连接这些实体的边：
   - 点击边查看关系描述
   - 识别超边（连接 3+ 实体）

### 步骤 4：过滤显示

1. 打开过滤面板
2. 只选择 "DISEASE" 类型
3. 设置权重阈值为 0.7
4. 现在只显示重要的疾病实体

### 步骤 5：分析关系网络

1. 观察疾病之间的聚类
2. 识别中心节点（连接最多的节点）
3. 发现意外的关联

**学到的技能**：
- ✅ 搜索实体
- ✅ 展开节点
- ✅ 过滤显示
- ✅ 识别超边

---

## 教程 2：执行复杂查询

**目标**：学习如何使用不同的查询模式

**场景**：您想了解糖尿病的风险因素和治疗方法。

### 查询 1：使用 Local 模式

**问题**："What is diabetes?"

1. 打开查询面板
2. 输入问题
3. 选择 "Local" 模式
4. 点击"查询"

**结果分析**：
- 答案主要基于 "Diabetes" 实体的描述
- 查询路径只包含少数节点
- 执行时间：~1.5 秒

**适用场景**：询问实体的定义和特征

### 查询 2：使用 Global 模式

**问题**："How is diabetes related to cardiovascular disease?"

1. 输入问题
2. 选择 "Global" 模式
3. 执行查询

**结果分析**：
- 答案强调两者之间的关系
- 查询路径包含连接两个实体的边
- 使用了关系描述作为上下文

**适用场景**：询问实体间的关系

### 查询 3：使用 Hybrid 模式（推荐）

**问题**："What are the risk factors and treatments for diabetes?"

1. 输入问题
2. 选择 "Hybrid" 模式
3. 执行查询

**结果分析**：
- 答案全面，包含风险因素和治疗方法
- 查询路径包含多个相关实体和关系
- 结合了实体描述和关系描述

**适用场景**：复杂问题，需要多方面信息

### 查询 4：调整参数

**问题**：同样的问题，但调整参数

1. 展开"高级选项"
2. 调整参数：
   ```
   top_k: 100 (增加检索数量)
   max_token_for_local_context: 6000 (增加上下文)
   ```
3. 重新执行查询

**对比结果**：
- 答案更详细
- 查询路径更长
- 执行时间更长（~3-4 秒）

**学到的技能**：
- ✅ 选择合适的查询模式
- ✅ 调整查询参数
- ✅ 理解不同模式的差异

---

## 教程 3：分析查询路径

**目标**：理解系统如何回答问题

**场景**：分析一个复杂查询的检索过程。

### 步骤 1：执行查询

**问题**："What lifestyle changes can help prevent cardiovascular disease?"

1. 使用 Hybrid 模式执行查询
2. 等待结果

### 步骤 2：查看查询路径

1. 观察图中高亮的节点和边
2. 注意节点的颜色深度（表示相关性）
3. 识别关键路径

**路径示例**：
```
Cardiovascular Disease (0.95)
  ↓
Exercise (0.88)
  ↓
Physical Activity (0.82)
  ↓
Healthy Lifestyle (0.79)
```

### 步骤 3：播放路径动画

1. 点击"播放动画"按钮
2. 观察系统按检索顺序高亮节点：
   - 第 1 步：检索 "Cardiovascular Disease"
   - 第 2 步：扩展到相关风险因素
   - 第 3 步：检索预防措施
   - 第 4 步：检索生活方式建议

3. 暂停动画，查看每一步的详情

### 步骤 4：分析上下文

1. 在结果面板查看"使用的上下文"
2. 每个上下文片段对应一个检索步骤
3. 理解系统如何组合信息生成答案

**上下文示例**：
```
1. "Regular exercise reduces cardiovascular disease risk by 30%..."
2. "Physical activity improves heart health through multiple mechanisms..."
3. "A healthy lifestyle includes balanced diet, exercise, and stress management..."
```

### 步骤 5：对比不同模式

1. 使用 Local 模式重新执行相同查询
2. 对比查询路径的差异：
   - Local：更短，集中在实体
   - Hybrid：更长，包含关系

**学到的技能**：
- ✅ 解读查询路径
- ✅ 使用路径动画
- ✅ 分析上下文使用
- ✅ 对比不同模式

---

## 教程 4：自定义可视化

**目标**：调整可视化效果以适应不同需求

**场景**：准备一个演示文稿，需要清晰的可视化效果。

### 任务 1：优化布局

**问题**：节点太密集，难以区分

**解决方案**：

1. 打开设置面板（⚙️）
2. 调整布局参数：
   ```
   斥力强度: 5000 → 8000 (增加)
   边长度: 100 → 150 (增加)
   ```
3. 点击"应用"
4. 观察节点分散开来

**效果**：节点间距增大，更容易识别

### 任务 2：选择配色方案

**问题**：默认配色不适合投影仪

**解决方案**：

1. 在设置面板选择"高对比度"主题
2. 或自定义颜色：
   ```
   DISEASE: 深红色 (#C41E3A)
   PERSON: 深蓝色 (#003366)
   ORGANIZATION: 深绿色 (#006400)
   ```
3. 应用更改

**效果**：颜色更鲜明，投影效果更好

### 任务 3：调整节点大小

**问题**：节点标签太小，观众看不清

**解决方案**：

1. 调整节点样式：
   ```
   节点大小: 20 → 30
   标签字体大小: 12 → 18
   ```
2. 启用"始终显示标签"

**效果**：标签更清晰可读

### 任务 4：简化显示

**问题**：边太多，图看起来很乱

**解决方案**：

1. 使用过滤器：
   - 权重阈值: 0.8（只显示重要的边）
   - 只选择关键实体类型

2. 调整边样式：
   ```
   边宽度: 2 → 1 (减小)
   边透明度: 1.0 → 0.6 (增加透明度)
   ```

**效果**：图更简洁，重点突出

### 任务 5：保存配置

1. 所有设置自动保存
2. 下次打开应用时自动恢复
3. 如需重置，点击"重置为默认"

**学到的技能**：
- ✅ 调整布局参数
- ✅ 自定义配色
- ✅ 优化节点和边样式
- ✅ 保存配置

---

## 教程 5：导出和分享

**目标**：导出可视化结果用于报告和分享

**场景**：需要在论文中展示知识图谱结构。

### 任务 1：导出高质量图像

**步骤**：

1. 调整视图到最佳角度：
   - 缩放到合适大小
   - 平移到居中位置
   - 确保关键节点都可见

2. 打开导出面板（📤）

3. 选择 PNG 格式：
   ```
   分辨率: 300 DPI (高质量)
   宽度: 3000px
   背景: 白色
   包含标签: 是
   ```

4. 点击"下载"

5. 图像保存为 `hypergraph_visualization.png`

**用途**：
- 插入论文、报告
- 打印海报
- 演示文稿

### 任务 2：导出矢量图

**步骤**：

1. 选择 SVG 格式
2. 配置选项：
   ```
   背景: 透明
   包含标签: 是
   ```
3. 下载 `hypergraph_visualization.svg`

**优势**：
- 无限缩放不失真
- 可在 Illustrator/Inkscape 中编辑
- 文件小

**用途**：
- 需要后期编辑
- 高质量印刷
- 网页展示

### 任务 3：导出数据

**步骤**：

1. 选择 JSON 格式
2. 下载 `hypergraph_data.json`

**数据内容**：
```json
{
  "nodes": [
    {
      "id": "cardiovascular_disease",
      "label": "Cardiovascular Disease",
      "type": "DISEASE",
      "position": {"x": 100, "y": 200}
    }
  ],
  "edges": [
    {
      "id": "edge1",
      "source": "cardiovascular_disease",
      "target": "hypertension",
      "weight": 0.88
    }
  ]
}
```

**用途**：
- 导入其他可视化工具（Gephi, Cytoscape）
- 数据分析（Python, R）
- 备份和版本控制

### 任务 4：导出查询结果

**步骤**：

1. 执行查询后，在结果面板点击"导出"
2. 选择格式：
   - **Markdown**：包含答案和上下文
   - **JSON**：结构化数据

**Markdown 示例**：
```markdown
# Query Result

**Question**: What are the risk factors for cardiovascular disease?

**Answer**: The main risk factors include...

**Query Path**:
- Cardiovascular Disease (0.95)
- Hypertension (0.88)
- Diabetes (0.82)

**Execution Time**: 2.34s
```

**用途**：
- 保存查询记录
- 分享查询结果
- 文档化研究过程

### 任务 5：批量导出

**场景**：需要导出多个视图

**步骤**：

1. 为每个视图设置过滤器
2. 依次导出：
   - `diseases_only.png`
   - `high_weight_edges.png`
   - `query_path_diabetes.png`

3. 使用脚本批量处理（高级）

**学到的技能**：
- ✅ 导出不同格式
- ✅ 配置导出选项
- ✅ 导出查询结果
- ✅ 批量导出

---

## 最佳实践

### 性能优化

#### 处理大规模图

**问题**：图有 10,000+ 节点，加载很慢

**解决方案**：

1. **使用过滤器**：
   - 只显示关键实体类型
   - 设置较高的权重阈值
   - 减少初始加载数量

2. **启用懒加载**：
   - 设置 → 性能 → 启用懒加载
   - 初始只加载 1000 个节点
   - 缩放时动态加载更多

3. **使用视口裁剪**：
   - 设置 → 性能 → 启用视口裁剪
   - 只渲染可见区域的节点

4. **优化布局**：
   - 减少布局迭代次数
   - 使用预计算布局

#### 提高查询速度

**方法**：

1. **减少检索数量**：
   ```
   top_k: 60 → 30
   ```

2. **使用缓存**：
   - 相同查询会使用缓存结果
   - 清除缓存：设置 → 高级 → 清除缓存

3. **选择合适的模式**：
   - 简单问题用 Local 或 Global
   - 复杂问题才用 Hybrid

### 可视化技巧

#### 突出重点

**方法**：

1. **使用颜色**：
   - 为关键实体类型设置醒目颜色
   - 使用灰色淡化次要节点

2. **调整大小**：
   - 根据权重调整节点大小
   - 重要节点更大

3. **使用过滤**：
   - 隐藏不相关的节点
   - 只显示查询路径

#### 清晰布局

**技巧**：

1. **增加间距**：
   - 提高斥力强度
   - 增加边长度

2. **分层显示**：
   - 使用层次布局（如果支持）
   - 手动调整关键节点位置

3. **减少交叉**：
   - 调整布局参数
   - 手动拖动节点

### 查询技巧

#### 提问技巧

**好的问题**：
- ✅ "What are the causes of diabetes?"
- ✅ "How is hypertension treated?"
- ✅ "What is the relationship between smoking and lung cancer?"

**不好的问题**：
- ❌ "Tell me everything about diseases"（太宽泛）
- ❌ "Is X better than Y?"（需要主观判断）
- ❌ "What will happen in the future?"（需要预测）

#### 迭代优化

**策略**：

1. **从简单开始**：
   - 先问基础问题
   - 理解实体和关系

2. **逐步深入**：
   - 基于初步结果提出更具体的问题
   - 使用查询历史追踪思路

3. **调整参数**：
   - 如果答案太简单，增加 top_k
   - 如果答案太长，减少 max_tokens

### 数据管理

#### 更新知识库

**流程**：

1. 添加新文档到数据目录
2. 运行构建脚本：
   ```bash
   python script_construct.py
   ```
3. 重启可视化系统
4. 验证新数据已加载

#### 版本控制

**建议**：

1. 为每个版本创建独立目录：
   ```
   expr/
   ├── v1_2024_01/
   ├── v2_2024_02/
   └── current/
   ```

2. 在配置中切换版本：
   ```python
   working_dir = "expr/v2_2024_02"
   ```

3. 导出 JSON 备份关键版本

### 协作和分享

#### 分享可视化

**方法**：

1. **导出图像**：
   - 适合快速分享
   - 包含在邮件、文档中

2. **导出数据**：
   - 适合技术协作
   - 其他人可以导入查看

3. **部署在线版本**：
   - 使用 Docker 部署
   - 团队成员通过浏览器访问

#### 文档化

**建议**：

1. **记录查询**：
   - 导出查询历史
   - 添加注释说明

2. **保存配置**：
   - 导出设置为 JSON
   - 团队使用统一配置

3. **截图和标注**：
   - 使用截图工具
   - 添加箭头和文字说明

---

## 进阶主题

### 自定义开发

如果您需要扩展功能，参考：
- [架构文档](./ARCHITECTURE.md)
- [API 文档](../api/README.md)
- [开发指南](./CONTRIBUTING.md)

### 集成其他工具

可以将 HyperGraphRAG 与以下工具集成：
- **Jupyter Notebook**：数据分析
- **Gephi**：高级网络分析
- **Neo4j**：图数据库存储
- **Tableau**：商业智能可视化

### 性能监控

使用浏览器开发者工具：
1. 打开 DevTools（F12）
2. 查看 Performance 标签
3. 记录和分析性能瓶颈

---

## 总结

通过本教程，您应该已经掌握：

- ✅ 浏览和探索超图
- ✅ 执行各种类型的查询
- ✅ 分析查询路径和结果
- ✅ 自定义可视化效果
- ✅ 导出和分享结果
- ✅ 性能优化技巧
- ✅ 最佳实践

继续探索，发现更多可能！

---

## 反馈和支持

- 📝 提交功能建议
- 🐛 报告 Bug
- 💬 加入社区讨论
- 📧 联系技术支持

祝您使用愉快！🚀
