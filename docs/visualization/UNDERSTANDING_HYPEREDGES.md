# 理解超边可视化

## 什么是超边？

在传统图中，一条边只能连接两个节点：
```
A ──── B
```

在超图中，一条**超边（Hyperedge）**可以同时连接多个节点：
```
    A
   / \
  /   \
 B --- C
  \   /
   \ /
    D
```
上图中，A、B、C、D 四个节点通过一条超边连接在一起。

## HyperGraphRAG 中的超边

在 HyperGraphRAG 中，超边表示从文本中提取的 **n 元关系**。

### 示例

**文本**：
> "This 2024 document updates the 2018 ESC/European Society of Hypertension (ESH) Guidelines on the management of arterial hypertension."

**提取的超边**：
- **实体 1**：2024 DOCUMENT
- **实体 2**：2018 ESC/ESH GUIDELINES  
- **实体 3**：MANAGEMENT OF ARTERIAL HYPERTENSION
- **关系描述**：上述文本内容

这三个实体通过一条超边连接，表示它们在同一个语义关系中。

## 当前可视化方案

### 问题

超边是一个独立的节点，连接多个实体。但在可视化时，如果直接显示超边节点，会导致：
- 节点数量翻倍（129 实体 + 84 超边 = 213 节点）
- 超边节点的标签很长（通常是完整的句子）
- 视觉上不直观

### 解决方案：转换为普通图

我们将超边转换为实体之间的边：

**原始结构（二部图）**：
```
Entity A ──┐
           ├── Hyperedge: "A, B, C are related"
Entity B ──┤
           │
Entity C ──┘
```

**转换后（普通图）**：
```
Entity A ────── Entity B
    \          /
     \        /
      Entity C
```

对于 n 个实体的超边，我们创建 C(n,2) = n×(n-1)/2 条边。

### 视觉标识

为了区分超边和普通边：

1. **颜色**：
   - 普通边（2 实体）：灰色实线
   - 超边（3+ 实体）：橙色虚线

2. **悬停提示**：
   - 显示 "⚡ Hyperedge (n entities)"
   - 列出所有连接的实体

3. **详情面板**：
   - 点击边后，显示完整的实体列表
   - 显示超边的描述（原始文本）

## 如何理解图中的超边

### 识别超边

在可视化中，**橙色虚线**表示超边。如果你看到多条橙色虚线连接同一组节点，它们来自同一个超边。

### 示例

假设有一个超边连接 A、B、C 三个实体：

**你会看到**：
- A ──── B（橙色虚线）
- A ──── C（橙色虚线）
- B ──── C（橙色虚线）

**这三条边实际上是同一个超边**，它们：
- 有相同的描述（description）
- 有相同的权重（weight）
- entities 字段包含 [A, B, C]

### 查看超边详情

1. **点击任意一条橙色虚线**
2. 在右侧详情面板查看：
   - "Hyperedge (3 entities)" 标签
   - 完整的实体列表
   - 超边的描述（原始关系文本）

## 超边的语义

超边表示**共现关系**：
- 这些实体在同一个文本片段中被提及
- 它们之间存在某种语义关联
- 关系描述通常是原始文本

### 权重

超边的权重（8.0-18.0）表示：
- 关系的重要性
- 在文档中出现的频率
- 实体之间的关联强度

权重越高，这个关系越重要。

## 未来改进

### 计划中的可视化方案

1. **混合模式**：
   - 简化视图（当前）：只显示实体
   - 完整视图：显示实体 + 超边节点

2. **复合节点**：
   - 使用 Cytoscape.js 的复合节点功能
   - 将超边显示为包含多个实体的容器

3. **交互式探索**：
   - 点击超边时高亮所有相关实体
   - 提供"查看原始超边"功能

## 常见问题

### Q: 为什么有些节点之间有多条边？

A: 这些节点可能通过多个不同的超边连接。每条边代表一个不同的语义关系。

### Q: 如何找到所有属于同一个超边的边？

A: 点击任意一条边，查看详情面板中的 "entities" 列表。所有连接这些实体的边都属于同一个超边。

### Q: 普通边和超边有什么区别？

A: 
- **普通边**：只连接 2 个实体（灰色实线）
- **超边**：连接 3+ 个实体（橙色虚线）

### Q: 为什么不直接显示超边节点？

A: 直接显示会导致：
- 视觉复杂度高（节点数翻倍）
- 超边标签太长（完整句子）
- 不符合用户对"关系图"的直觉

当前方案在保留超边信息的同时，提供了更直观的可视化。

## 参考

- [超图可视化策略](./HYPERGRAPH_VISUALIZATION_STRATEGIES.md) - 详细的技术方案对比
- [HyperGraphRAG 论文](https://arxiv.org/abs/2407.17159) - 超图 RAG 的理论基础
